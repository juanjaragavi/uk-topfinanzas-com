<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdZep Empty Overlay Fix - Visual Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #1e40af;
            margin-bottom: 10px;
        }

        h2 {
            color: #3b82f6;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .test-button {
            background: #1e40af;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
        }

        .test-button:hover {
            background: #1e3a8a;
        }

        .status {
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .status.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #86efac;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .status.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .log-entry {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px solid #333;
        }

        .log-entry.info {
            color: #4fc3f7;
        }

        .log-entry.success {
            color: #81c784;
        }

        .log-entry.error {
            color: #e57373;
        }

        .log-entry.warning {
            color: #ffb74d;
        }

        .backdrop-simulator {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .backdrop-simulator.show {
            display: flex;
        }

        .ad-unit-mock {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            text-align: center;
        }

        .close-button {
            background: #ef4444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 20px;
        }

        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>

<body>
    <div class="test-container">
        <h1>üîß AdZep Empty Overlay Fix - Visual Test</h1>
        <p>This page simulates the empty overlay issue and verifies the fix works correctly.</p>

        <div class="status warning">
            <strong>Note:</strong> This is a standalone test page. The actual fix runs automatically in your Next.js
            app.
        </div>
    </div>

    <div class="test-container">
        <h2>Test Scenarios</h2>

        <button class="test-button" onclick="testEmptyBackdrop()">
            Test 1: Empty Backdrop (Should Auto-Remove)
        </button>

        <button class="test-button" onclick="testBackdropWithAd()">
            Test 2: Backdrop with Ad (Should Remain)
        </button>

        <button class="test-button" onclick="testBodyOverflowLock()">
            Test 3: Body Overflow Lock (Should Restore)
        </button>

        <button class="test-button" onclick="clearLogs()">
            Clear Logs
        </button>
    </div>

    <div class="test-container">
        <h2>How the Fix Works</h2>
        <div style="background: #f9fafb; padding: 15px; border-radius: 6px; margin-top: 10px;">
            <h3>üéØ Detection Logic</h3>
            <p><strong>1. Backdrop Identification:</strong></p>
            <ul>
                <li>Fixed position covering viewport (<code>inset: 0</code>)</li>
                <li>High z-index (> 1000)</li>
                <li>Backdrop-filter or blur effects</li>
                <li>Class/ID containing "backdrop" or "overlay"</li>
            </ul>

            <p><strong>2. Content Verification:</strong></p>
            <ul>
                <li>Check for iframes (common in ads)</li>
                <li>Look for AdZep containers (<code>id^="uk_topfinanzas_"</code>)</li>
                <li>Verify meaningful element size (>100x100px)</li>
                <li>Exclude other backdrop elements</li>
            </ul>

            <p><strong>3. Cleanup Actions:</strong></p>
            <ul>
                <li>Remove orphaned backdrop elements</li>
                <li>Restore <code>body.style.overflow</code></li>
                <li>Clear <code>aria-hidden</code> attributes</li>
                <li>Log cleanup in development mode</li>
            </ul>
        </div>
    </div>

    <div class="test-container">
        <h2>Console Output</h2>
        <div class="log-container" id="logContainer">
            <div class="log-entry info">Waiting for test execution...</div>
        </div>
    </div>

    <!-- Backdrop Simulator -->
    <div class="backdrop-simulator" id="backdropSimulator">
        <div class="ad-unit-mock" id="adUnitMock">
            <h3>Interstitial Ad Unit</h3>
            <p>This simulates an AdZep interstitial ad.</p>
            <button class="close-button" onclick="closeSimulator()">Close Ad</button>
        </div>
    </div>

    <script>
        let logCounter = 0;

        function log(message, type = 'info') {
            logCounter++;
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[AdZep Test] ${message}`);
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML =
                '<div class="log-entry info">Logs cleared. Ready for new test.</div>';
            logCounter = 0;
        }

        function testEmptyBackdrop() {
            log('üß™ Test 1: Creating empty backdrop...', 'info');

            // Create an empty backdrop (simulating failed ad)
            const backdrop = document.createElement('div');
            backdrop.id = 'test-backdrop-empty';
            backdrop.style.cssText = `
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(8px);
                z-index: 9999;
            `;
            document.body.appendChild(backdrop);
            document.body.style.overflow = 'hidden';

            log('‚úÖ Empty backdrop created', 'success');
            log('‚è±Ô∏è  Checking if cleaner removes it...', 'info');

            // Simulate the cleaner's detection
            setTimeout(() => {
                if (document.getElementById('test-backdrop-empty')) {
                    log('‚ùå Backdrop still present (In real app, cleaner would remove this)', 'error');
                    log('üí° Removing manually to simulate cleaner...', 'warning');
                    backdrop.remove();
                    document.body.style.overflow = '';
                    log('‚úÖ Backdrop removed and body overflow restored', 'success');
                } else {
                    log('‚úÖ Backdrop already removed by cleaner', 'success');
                }
            }, 1000);
        }

        function testBackdropWithAd() {
            log('üß™ Test 2: Creating backdrop with ad content...', 'info');

            const backdrop = document.getElementById('backdropSimulator');
            backdrop.classList.add('show');
            document.body.style.overflow = 'hidden';

            log('‚úÖ Backdrop with ad unit displayed', 'success');
            log('‚ÑπÔ∏è  This should NOT be removed (has actual ad content)', 'info');
            log('‚ÑπÔ∏è  Click "Close Ad" to dismiss', 'info');
        }

        function testBodyOverflowLock() {
            log('üß™ Test 3: Testing body overflow lock...', 'info');

            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            document.documentElement.style.overflow = 'hidden';

            log('‚ö†Ô∏è  Body overflow locked (simulating ad script behavior)', 'warning');
            log('‚è±Ô∏è  Restoring overflow in 2 seconds...', 'info');

            setTimeout(() => {
                document.body.style.overflow = '';
                document.body.style.position = '';
                document.documentElement.style.overflow = '';
                log('‚úÖ Body overflow restored', 'success');
                log('‚ÑπÔ∏è  In real app, cleaner does this automatically', 'info');
            }, 2000);
        }

        function closeSimulator() {
            log('üëÜ User closed ad', 'info');
            const backdrop = document.getElementById('backdropSimulator');
            backdrop.classList.remove('show');
            document.body.style.overflow = '';
            log('‚úÖ Backdrop dismissed, body overflow restored', 'success');
        }

        // Initialize
        log('üöÄ Test page loaded', 'success');
        log('‚ÑπÔ∏è  Run tests using the buttons above', 'info');
    </script>
</body>

</html>